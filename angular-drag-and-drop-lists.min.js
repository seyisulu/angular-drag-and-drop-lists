(function(e){var b="application/x-dnd";var w="application/json";var E="Text";var C=["move","copy","link"];e.directive("dndDraggable",["$parse","$timeout",function(f,u){return function(i,o,l){o.attr("draggable","true");if(l.dndDisableIf){i.$watch(l.dndDisableIf,function(e){o.attr("draggable",!e)})}o.on("dragstart",function(n){n=n.originalEvent||n;if(o.attr("draggable")=="false")return true;S.isDragging=true;S.itemType=l.dndType&&i.$eval(l.dndType).toLowerCase();S.dropEffect="none";S.effectAllowed=l.dndEffectAllowed||C[0];n.dataTransfer.effectAllowed=S.effectAllowed;var r=i.$eval(l.dndDraggable);var e=b+(S.itemType?"-"+S.itemType:"");try{n.dataTransfer.setData(e,angular.toJson(r))}catch(e){var t=angular.toJson({item:r,type:S.itemType});try{n.dataTransfer.setData(w,t)}catch(e){var a=x(C,S.effectAllowed);n.dataTransfer.effectAllowed=a[0];n.dataTransfer.setData(E,t)}}o.addClass("dndDragging");u(function(){o.addClass("dndDraggingSource")},0);if(n._dndHandle&&n.dataTransfer.setDragImage){n.dataTransfer.setDragImage(o[0],0,0)}f(l.dndDragstart)(i,{event:n});if(l.dndCallback){var d=f(l.dndCallback);S.callback=function(e){return d(i,e||{})}}n.stopPropagation()});o.on("dragend",function(r){r=r.originalEvent||r;i.$apply(function(){var e=S.dropEffect;var n={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"};f(l[n[e]])(i,{event:r});f(l.dndDragend)(i,{event:r,dropEffect:e})});S.isDragging=false;S.callback=undefined;o.removeClass("dndDragging");o.removeClass("dndDraggingSource");r.stopPropagation();u(function(){o.removeClass("dndDraggingSource")},0)});o.on("click",function(e){if(!l.dndSelected)return;e=e.originalEvent||e;i.$apply(function(){f(l.dndSelected)(i,{event:e})});e.stopPropagation()});o.on("selectstart",function(){if(this.dragDrop)this.dragDrop()})}}]);e.directive("dndList",["$parse",function(i){return function(o,l,f){var u=e();u.remove();var s=u[0];var c=l[0];var g={};l.on("dragenter",function(e){e=e.originalEvent||e;var n=f.dndAllowedTypes&&o.$eval(f.dndAllowedTypes);g={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:f.dndDisableIf&&o.$eval(f.dndDisableIf),externalSources:f.dndExternalSources&&o.$eval(f.dndExternalSources),horizontal:f.dndHorizontalList&&o.$eval(f.dndHorizontalList)};var r=v(e.dataTransfer.types);if(!r||!D(p(r)))return true;e.preventDefault()});l.on("dragover",function(e){e=e.originalEvent||e;var n=v(e.dataTransfer.types);var r=p(n);if(!n||!D(r))return true;if(s.parentNode!=c){l.append(u)}if(e.target!=c){var t=e.target;while(t.parentNode!=c&&t.parentNode){t=t.parentNode}if(t.parentNode==c&&t!=s){var a=t.getBoundingClientRect();if(g.horizontal){var d=e.clientX<a.left+a.width/2}else{var d=e.clientY<a.top+a.height/2}if(d){if(t.previousSibling!=s){c.insertBefore(s,t)}}else{if(t.nextSibling!=s){c.insertBefore(s,t.nextSibling)}}}}var i=n==E;var o=y(e,i);if(o=="none")return T();if(f.dndDragover&&!h(f.dndDragover,e,o,r)){return T()}e.preventDefault();if(!i){e.dataTransfer.dropEffect=o}l.addClass("dndDragover");e.stopPropagation();return false});l.on("drop",function(e){e=e.originalEvent||e;var n=v(e.dataTransfer.types);var r=p(n);if(!n||!D(r))return true;e.preventDefault();try{var t=JSON.parse(e.dataTransfer.getData(n))}catch(e){return T()}if(n==E||n==w){r=t.type||undefined;t=t.item;if(!D(r))return T()}var a=n==E;var d=y(e,a);if(d=="none")return T();var i=m();if(f.dndDrop){t=h(f.dndDrop,e,d,r,i,t);if(!t)return T()}S.dropEffect=d;if(!a){e.dataTransfer.dropEffect=d}if(t!==true){o.$apply(function(){o.$eval(f.dndList).splice(i,0,t)})}h(f.dndInserted,e,d,r,i,t);T();e.stopPropagation();return false});l.on("dragleave",function(e){e=e.originalEvent||e;var n=document.elementFromPoint(e.clientX,e.clientY);if(c.contains(n)&&!e._dndPhShown){e._dndPhShown=true}else{T()}});function v(e){if(!e)return E;for(var n=0;n<e.length;n++){if(e[n]==E||e[n]==w||e[n].substr(0,b.length)==b){return e[n]}}return null}function p(e){if(S.isDragging)return S.itemType||undefined;if(e==E||e==w)return null;return e&&e.substr(b.length+1)||undefined}function D(e){if(g.disabled)return false;if(!g.externalSources&&!S.isDragging)return false;if(!g.allowedTypes||e===null)return true;return e&&g.allowedTypes.indexOf(e)!=-1}function y(e,n){var r=C;if(!n){r=x(r,e.dataTransfer.effectAllowed)}if(S.isDragging){r=x(r,S.effectAllowed)}if(f.dndEffectAllowed){r=x(r,f.dndEffectAllowed)}if(!r.length){return"none"}else if(e.ctrlKey&&r.indexOf("copy")!=-1){return"copy"}else if(e.altKey&&r.indexOf("link")!=-1){return"link"}else{return r[0]}}function T(){u.remove();l.removeClass("dndDragover");return true}function h(e,n,r,t,a,d){return i(e)(o,{callback:S.callback,dropEffect:r,event:n,external:!S.isDragging,index:a!==undefined?a:m(),item:d||undefined,type:t})}function m(){return Array.prototype.indexOf.call(c.children,s)}function e(){var r;angular.forEach(l.children(),function(e){var n=angular.element(e);if(n.hasClass("dndPlaceholder")){r=n}});return r||angular.element("<li class='dndPlaceholder'></li>")}}}]);e.directive("dndNodrag",function(){return function(e,n,r){n.attr("draggable","true");n.on("dragstart",function(e){e=e.originalEvent||e;if(!e._dndHandle){if(!(e.dataTransfer.types&&e.dataTransfer.types.length)){e.preventDefault()}e.stopPropagation()}});n.on("dragend",function(e){e=e.originalEvent||e;if(!e._dndHandle){e.stopPropagation()}})}});e.directive("dndHandle",function(){return function(e,n,r){n.attr("draggable","true");n.on("dragstart dragend",function(e){e=e.originalEvent||e;e._dndHandle=true})}});function x(e,n){if(n=="all")return e;return e.filter(function(e){return n.toLowerCase().indexOf(e)!=-1})}var S={}})(angular.module("dndLists",[]));